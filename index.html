
<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="csrf-token" content="tZ6iOBp3RhQVr1olzx0K9Q2bgCnCRyvy9piq9J02">
    <title>Exchange | dexzbitz</title>
    <meta content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no" name="viewport">
    <link rel="icon" type="image/png" sizes="32x32" href="https://dexzbitz.live/common/images/favicon-32x32.png">
        <link rel="stylesheet" href="https://dexzbitz.live/css/app.css">
    <link rel="stylesheet" href="https://dexzbitz.live/common/vendors/bootstrap/css/bootstrap.min.css">
    <link rel="stylesheet" href="https://dexzbitz.live/common/vendors/font-awesome/css/font-awesome.min.css">
    <link rel="stylesheet" href="https://dexzbitz.live/backend/assets/css/admin_lte.css">
    <link rel="stylesheet" href="https://dexzbitz.live/backend/assets/css/template_color.css">
    <!-- iCheck -->
    <link rel="stylesheet" href="https://dexzbitz.live/common/vendors/iCheck/all.css">

    <!-- for datatable and date picker -->
    <link rel="stylesheet" href="https://dexzbitz.live/common/vendors/datepicker/datepicker.css">
    <link rel="stylesheet" href="https://dexzbitz.live/common/vendors/datatable_responsive/datatables/plugins/bootstrap/datatables.bootstrap.css">
    <link rel="stylesheet" href="https://dexzbitz.live/common/vendors/datatable_responsive/datatables/datatables.min.css">
    <link rel="stylesheet" href="https://dexzbitz.live/backend/assets/style.css">

      

    <!--[if lt IE 9]>
    <script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
    <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
    <![endif]-->

    
    <!-- Google Font -->
    <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Source+Sans+Pro:300,400,600,700,300italic,400italic,600italic">
</head><body class="skin-blue layout-top-nav">
    <div class="wrapper" id="app">
<header class="main-header">
    <nav class="navbar navbar-static-top">
        <div class="container-fluid">
            <div class="navbar-header">
                                    <a href="https://dexzbitz.live" class="navbar-brand"><img
                                style="width: 40px;height: 40px; margin-top: -10px"
                                src=""></a>
                
                <button type="button" class="navbar-toggle collapsed" data-toggle="collapse"
                        data-target="#navbar-collapse">
                    <i class="fa fa-bars"></i>
                </button>
            </div>

            <div class="collapse navbar-collapse pull-left" id="navbar-collapse">
                <ul class="nav navbar-nav">
                    <li class=""><a href="https://dexzbitz.live">Home</a></li>
                    <li class="active"><a
                                href="https://dexzbitz.live/exchange">Exchange</a></li>
                    
                </ul>
            </div>

            <div class="navbar-custom-menu">
                <ul class="nav navbar-nav">
                                                            <li>
                            <a href="https://dexzbitz.live/login">Login</a>
                        </li>

                        <li>
                            <a href="https://dexzbitz.live/register">Register</a>
                        </li>
                                    </ul>
            </div>
        </div>
    </nav>
</header>
<!-- Content Wrapper. Contains page content -->
    <div class="content-wrapper">
        <!-- Main content -->
        <section class="content">
            
  
 

<meta name="viewport" content="width=device-width, initial-scale=1">
<style>
body {
 background-color: black;
  color: white;
  font-size: small;
}

table.dataTable, table.dataTable th, table.dataTable td {
    -webkit-box-sizing: content-box;
    box-sizing: content-box;
    COLOR: WHITE;
    BACKGROUND-COLOR: BLACK;
}
  
}
</style>
</head>
<body>


<div class="box box-solid box-success">
    <div class="row">
        <div class="col-md-8">
            <div class="box box-borderless full-in-small">
                <div class="box-header" style="padding-bottom: 5px;border-bottom:1px solid #efefef">
                    <div class="row">
    <div class="col-md-12">
<div class="summary-padding-fixer">
<div class="row dc-clear">
    <div class="col-md-4 col-sm-6 col-lg-2 text-center">
        
            <small class="text-bold cm-ml-10 text-green text-left">
                <span class="stock_item"></span>/
                <span class="base_item"></span>
            </small>
        </div>
    </div>
    <div class="col-md-4 col-sm-6 col-lg-2 exchange-table">
        <div class="text-center border-right">
            <span class="description-text">Last Price: </span><br>
            <strong><span id="last_price" class="description-header"></span></strong>
        </div>
    </div>

    <div class="col-md-4 col-sm-6 col-lg-2 exchange-table">
        <div class="text-center border-right">
            <span class="description-text">24hr Change: </span><br>
            <strong><span id="_24_hour_percentage"
                          class="description-header description-percentage"><i
                            class="fa fa-caret-up"></i>0%</span></strong>
        </div>
    </div>
    <div class="col-md-4 col-sm-6 col-lg-2 exchange-table">
        <div class="text-center border-right">
            <span class="description-text">24hr High: </span><br>
            <strong><span id="_24_hour_high" class="description-header"></span></strong>
        </div>
    </div>
    <div class="col-md-4 col-sm-6 col-lg-2 exchange-table">
        <div class="text-center border-right">
            <span class="description-text">24hr Low: </span><br>
            <strong><span id="_24_hour_low" class="description-header"></span></strong>
        </div>
    </div>

    <div class="col-md-4 col-sm-6 col-lg-2 text-center exchange-table">
                            <span class="description-text" style="margin: 0">
                                24hr Volume:
                            </span><br>

        <span id="_24_hour_item_volume" class="strong"></span>
        <span class="stock_item"></span>/
        <span id="_24_hour_base_volume" class="strong"></span>
        <span class="base_item"></span>
    </div>

</div>
</div>                </div>

                <div class="box-body" style="padding-top: 10px">
                    <div class="box box-solid box-danger">
	
<div class="col-md-12">

        <div class="exchange-loader" id="echart" style="width:100%; height: 300px;"></div>

    </div>
	<div class="col-md-12">
	</div>
	


<div class="row">
    <div class="col-md-12 text-center">
        <ul id="candlestick_zoom" class="pagination pagination-sm">
		<li class=""><a data-interval="5" href="javascript:">5M</a></li>
            <li class=""><a data-interval="15" href="javascript:">15M</a></li>
            <li class=""><a data-interval="30" href="javascript:">30M</a></li>
           
            <li  class=""><a data-zoom="360" href="javascript:">6h</a></li>
            <li  class=""><a data-zoom="1440" href="javascript:">1D</a></li>
            <li  class=""><a data-zoom="2880" href="javascript:">2D</a></li>
            <li  class=""><a data-zoom="5760" href="javascript:">4D</a></li>
            <li  class=""><a data-zoom="10080" href="javascript:">1W</a></li>
            <li class="disabled"><a data-zoom="20160" href="javascript:">2W</a></li>
            <li  class=""><a data-zoom="43200" href="javascript:">1M</a></li>
            <li  class=""><a data-zoom="0" href="javascript:">All</a></li>
        
         
            
        
        </ul>
    </div>
</div>

                    </div>
            </div>
        </div>
    </div>
	  </div>
	<div class="col-md-4">
	<div class="box box-solid box-success">
	
             <div class="box box-solid box-success">
<div id="fixed-stock-market">
    <div>
      
           
          
            <div class="box-body" id="stock-market-section">
                <table id="stock_market_table" class="table table-hover table-responsive small exchange-table">
                    <thead>
                    <tr>
				
                        <th>Coin</th>
                        <th>PRICE</th>
                        <th>VOLUME</th>
                        <th>CHANGE</th>
                    </tr>
                    </thead>
                </table>
            </div>
        </div>
    </div>
</div>
</div>        </div>
	    </div>
		   </div>


<div class="box box-solid box-primary">
    <div class="row">
        <div class="col-md-4">
            <div class="box box-solid box-success">
    <div class="box-header with-border">
	
        <h3 class="box-title text-uppercase">Buy <span class="stock_item"></span></h3>
        
    </div>
    <div class="box-body">
        <form method="post" action="https://dexzbitz.live/orders" id="buy_order_form"
              class="form-horizontal show-form-data" data-ajax-submission="y"
              data-reset-on-success="y">
            <input type="hidden" name="_token" value="tZ6iOBp3RhQVr1olzx0K9Q2bgCnCRyvy9piq9J02">            <input type="hidden" value="zcf" name="base_key">
            <input type="hidden" value="1"
                   name="fake_339">
            <input type="hidden" value="1"
                   name="fake_338">
            <input type="hidden" value="8"
                   name="fake_337" class="stock-pair">
            <div class="form-group">
                <label for="price" class="col-xs-4 control-label">Price</label>
                <div class="col-md-8">
                    <div class="input-group input-group-sm">
                        <input type="text" class="form-control text-right price"
                               name="fake_340">
                        <span class="input-group-addon text-uppercase">
                                                <span class="base_item"></span>
                                            </span>
                    </div>
                </div>
            </div>

            <div class="form-group">
                <label for="amount" class="col-xs-4 control-label">Amount</label>
                <div class="col-md-8">
                    <div class="input-group input-group-sm">
                        <input type="text" class="form-control text-right amount"
                               name="fake_341">
                        <span class="input-group-addon text-uppercase">
                                                <span class="stock_item"></span>
                                            </span>
                    </div>
                </div>
            </div>

            <hr class="margin-top-none margin-b-10">

            <div class="form-group">
                <label for="total" class="col-xs-4 control-label">Total</label>
                <div class="col-md-8">
                    <div class="input-group input-group-sm">
                        <input type="text" class="form-control text-right total">
                        <span class="input-group-addon text-uppercase">
                                                <span class="base_item"></span>
                                            </span>
                    </div>
                </div>
            </div>

            <div style="margin-top: 30px">
                Fee: 0.1/0.2%
            </div>

            <hr class="margin-t-10 margin-b-10">
            
                            <a href="https://dexzbitz.live/login">Login</a> or <a
                        href="https://dexzbitz.live/register">Register</a> to trade
                    </form>
    </div>
</div>
			<div class="box box-solid box-success">
            <div class="box-header">
                <h3 class="box-title text-uppercase">Buyers</h3>
                <div class="pull-right text-bold">Total:
                    <span id="total_buy_order_in_base"></span>
                    <span class="base_item"></span>
                </div>
            </div>

            <div class="box-body pt-0" style="height: 350px">
                <table id="buy_order_table"
                       class="table table-hover table-striped table-responsive small exchange-table">
                    <thead class="no-clicke-header">
                    <tr>
                        <th>PRICE</th>
                        <th><span class="stock_item"></span></th>
                        <th><span class="base_item"></span></th>
                        <th class="hide_in_mobile_small">SUM(<span class="base_item"></span>)</th>
                    </tr>
                    </thead>
                </table>
            </div>
        </div>
		
           </div>

        <div class="col-md-4">
          <div class="box box-solid box-danger">
    <div class="box-header with-border">
        <h3 class="box-title text-uppercase">SELL <span class="stock_item"></span></h3>
        
    </div>
    <div class="box-body">
        <form method="post" action="https://dexzbitz.live/orders" id="sell_order_form"
              class="form-horizontal show-form-data" data-ajax-submission="y"
              data-reset-on-success="y">
            <input type="hidden" name="_token" value="tZ6iOBp3RhQVr1olzx0K9Q2bgCnCRyvy9piq9J02">            <input type="hidden" value="zcf" name="base_key">
            <input type="hidden" value="2"
                   name="fake_339">
            <input type="hidden" value="1"
                   name="fake_338">
            <input type="hidden" value="8"
                   name="fake_337" class="stock-pair">
            <div class="form-group">
                <label for="price" class="col-xs-4 control-label">Price</label>
                <div class="col-md-8">
                    <div class="input-group input-group-sm">
                        <input type="text" class="form-control text-right price"
                               name="fake_340">
                        <span class="input-group-addon text-uppercase">
                                                <span class="base_item"></span>
                                            </span>
                    </div>

                </div>
            </div>

            <div class="form-group">
                <label for="amount" class="col-xs-4 control-label">Amount</label>
                <div class="col-md-8">
                    <div class="input-group input-group-sm">
                        <input type="text" class="form-control text-right amount"
                               name="fake_341">
                        <span class="input-group-addon text-uppercase">
                                                <span class="stock_item"></span>
                                            </span>
                    </div>
                </div>
            </div>

            <hr class="margin-top-none margin-b-10">

            <div class="form-group">
                <label for="total" class="col-xs-4 control-label">Total</label>
                <div class="col-md-8">
                    <div class="input-group input-group-sm">
                        <input type="text" class="form-control text-right total">
                        <span class="input-group-addon text-uppercase">
                                                <span class="base_item"></span>
                                            </span>
                    </div>
                </div>
            </div>

            <div style="margin-top: 30px">
                Fee: 0.1/0.2%
            </div>

            <hr class="margin-t-10 margin-b-10">
            
                            <a href="https://dexzbitz.live/login">Login</a> or <a
                        href="https://dexzbitz.live/register">Register</a> to trade
                    </form>
    </div>
</div>
		  <div class="box box-solid box-success">
<div class="box-header">
               
                <div class="pull-right text-bold">Sell Total:
                    <span id="total_sell_order_in_item"></span>
                    <span class="stock_item"></span>
                </div>
            </div>
            <div class="box-body pt-0" style="height: 350px">
                <table id="sell_order_table"
                       class="table table-hover table-striped table-responsive small exchange-table">
                    <thead class="no-clicke-header">
                    <tr>
                        <th>PRICE</th>
                        <th><span class="stock_item"></span></th>
                        <th><span class="base_item"></span></th>
                        <th class="hide_in_mobile_small">SUM(<span class="base_item"></span>)</th>
                    </tr>
                    </thead>
                </table>
            </div>
			</div>        </div>
		

        <div class="col-md-4">
		 <div class="row">
    <div class="col-md-12">
        <div class="nav-tabs-custom full-in-small" style="cursor: move;">
            <ul class="nav nav-tabs ui-sortable-handle">
                <li class="active">
                    <a href="#market_trade" data-toggle="tab" aria-expanded="false">MARKET TRADES</a>
                </li>
                            </ul>
            <div class="tab-content">
                <div class="tab-pane active" id="market_trade">
                    <table id="trade_history_table" class="table table-hover table-responsive small exchange-table"
                           style="width:100%"height="550">
                        <thead>
                        <tr>
                            <th class="hide_in_mobile">DATE</th>
                            <th>TYPE</th>
                            <th class="text-center">PRICE</th>
                            <th class="text-center">AMOUNT</th>
                            <th class="text-center hide_in_mobile_small">TOTAL</th>
                        </tr>
                        </thead>
                    </table>
                </div>
                            </div>
        </div>
    </div>
</div>               
        </div>
		
    </div>
	</div>

  
   

  

        </section>
        <!-- /.content -->
        <!-- Extended content -->
            </div>
    <!-- /.content-wrapper -->
<footer class="main-footer">
    Copyright &copy; 2019-2020 <a href="https://dexzbitz.live">DEXZBITZ</a>. All rights reserved.
</footer>

<!-- /.control-sidebar -->
</div>
<!-- ./wrapper -->
<div class="flash-message">
    <div class="centralize-wrapper">
        <div class="centralize-inner">
            <div class="centralize-content">
                <div class="flash-removable">
                    <button type="button" class="close flash-close" aria-hidden="true">Ã—</button>
                    <div class="flash-icon"></div>
                    <p>
                                            </p>
                    <a class="flash-confirm hidden-flash-item btn btn-sm btn-info btn-flat" href="javascript:;">Confirm</a>
                    <a class="flash-close hidden-flash-item btn btn-sm btn-warning btn-flat" href="javascript:;">Cancel</a>
                </div>
            </div>
        </div>
    </div>
</div><!-- jQuery 3 -->
<script src="https://dexzbitz.live/js/app.js?t=vlVnQ9CTik"></script>
<script src="https://dexzbitz.live/common/vendors/jquery-ui/jquery-ui.min.js"></script>
<script src="https://dexzbitz.live/common/vendors/bootstrap/js/bootstrap.min.js"></script>
<script src="https://dexzbitz.live/common/vendors/iCheck/icheck.min.js"></script>
<script src="https://dexzbitz.live/backend/assets/js/adminlte.min.js"></script>
<script src="https://dexzbitz.live/backend/assets/js/custom.js"></script>
    <script src="https://dexzbitz.live/common/vendors/bcmath/libbcmath-min.js"></script>
    <script src="https://dexzbitz.live/common/vendors/bcmath/bcmath.js"></script>
    <script src="https://dexzbitz.live/common/vendors/mCustomScrollbar/jquery.mCustomScrollbar.concat.min.js"></script>
    <script src="https://dexzbitz.live/common/vendors/datatable_responsive/datatables/datatables.min.js"></script>
    <script src="https://dexzbitz.live/common/vendors/datatable_responsive/datatables/plugins/bootstrap/datatables.bootstrap.js"></script>
    <script src="https://dexzbitz.live/common/vendors/echart/echarts.min.js"></script>
    <script src="https://dexzbitz.live/js/chart.js"></script>
    <script src="https://dexzbitz.live/common/vendors/cvalidator/cvalidator.js"></script>

    <script>

    let defaultBaseId = parseInt(9);
    let defaultStockId = parseInt(1);
    let defaultStockPairId = parseInt(8);
    let defaultInterval = parseInt(240);
    let defaultZoom = parseInt(20160);
    let stockMarketTable = '';
    let buyOrderTable = '';
    let sellOrderTable = '';
    let myOpenOrderTable = '';
    let myTradeHistoryTable = '';
    let tradeHistoryTable = '';
    let exchangeTypeBuy = '1';
    let exchangeTypeSell = '2';
    let exchangeCategory = '1';
    let exchangeType = JSON.parse('{"1":"Buy","2":"Sell"}');
    let user = JSON.parse('null');
    let orderCancelURL = 'https://dexzbitz.live/orders/##';
    let chartData;
    let sellOrderLastPrice = 0;
    let buyOrderLastPrice = 0;
    let orderBookRowPerPage = 50;
    let sellOrderTableLoadMore = true;
    let buyOrderTableLoadMore = true;

    bcscale(8);

    $(document).ready(function () {


        $('#buy_order_form').cValidate({
            showErrorsInFlash: true,
            preventSubmit: true
        });

        $('#sell_order_form').cValidate({
            showErrorsInFlash: true,
            preventSubmit: true
        });

        $('#stop_limit_form').cValidate({
            showErrorsInFlash: true,
            preventSubmit: true
        });


        stockMarketTable = $('#stock_market_table').DataTable({
            destroy: true,
            paging: false,
            order: [[0, 'asc']],
            dom: '<"filter">ft',
            select: {
                style: 'single',
                selector: 'tr:not(.selected)'
            },
            scrollY: 500,
            scrollCollapse: true,
            language: {search: "", searchPlaceholder: "Search..."},
            ajax: {
                url: 'https://dexzbitz.live/exchange/get-coin-market',
                dataSrc: function (json) {

                    if (json.baseItems) {
                        let html = '<select id="datatable-filter" class="form-control">';

                        $.each(json.baseItems, function (baseId, baseItem) {
                            let selected = defaultBaseId == baseId ? "selected" : "";
                            html += '<option ' + selected + ' value="' + baseId + '">' + baseItem + '</option>';
                        });
                        html += '</select>';

                        $("div.filter").html(html);
                    }
                    return json.stockItems;
                }
            },
            initComplete: function () {
                stockMarketTable.column(4).search(defaultBaseId).draw();
                let selectedRowData = stockMarketTable.row({selected: true}).data();
                updateStockPairSummary(selectedRowData);
                                initStockChart(defaultStockPairId, defaultInterval);
                initBuyStockOrderTable();
                initSellStockOrderTable();
                initTradeHistoryTable();
                broadcast();
            },
            rowCallback: function (row, data) {
                if (data.id == defaultStockPairId) {
                    stockMarketTable.row(row).select();
                    changeUrl(data);
                }

                $(row).attr('id', 'stock_market' + data.id);
            },
            columns: [
                {
                    data: "stock_item_abbr",
                },
                {
                    data: "last_price",
                },
                {
                    data: "exchanged_base_item_volume_24",
                    render: function (data) {
                        return number_format(data, 3)
                    }
                },
                {
                    data: "change_24",
                    render: function (data) {
                        let change = '';
                        if (parseFloat(data) > 0) {
                            change = '<i class="fa fa-caret-up text-green"></i> ';
                        } else if (parseFloat(data) < 0) {
                            change = '<i class="fa fa-caret-down text-red"></i> ';
                        } else {
                            change = '<i class="fa fa-sort text-gray"></i> ';
                        }
                        return change + number_format(Math.abs(data), 2);
                    }
                },
                {
                    data: "base_item_id",
                    visible: false
                }
            ]
        });

        $(document).on('change', '#datatable-filter', function () {
            stockMarketTable.column(4).search(this.value).draw();
        });

        stockMarketTable.on('user-select', function (e, dt, type, cell, originalEvent) {
            if ( type === 'row') {
                let row = dt.row(originalEvent.currentTarget);
                let data = row.data();

                defaultStockPairId = data.id;
                defaultStockId = data.stock_item_id;
                defaultBaseId = data.base_item_id;
                changeUrl(data);
                updateStockPairSummary(data);
                initOrderForm();
                initStockChart(defaultStockPairId, defaultInterval);
                initBuyStockOrderTable();
                initSellStockOrderTable();
                initMyOpenOrderTable();
                initMyTradeHistoryTable();
                initTradeHistoryTable();
                broadcast();
            }
        });

        $(document).on('click', '#buy_order_table tbody:first tr', function () {
            let data = buyOrderTable.row(this).data();
            fillUpSellOrderForm(data);
        });

        $(document).on('click', '#sell_order_table tbody:first tr', function () {
            let data = sellOrderTable.row(this).data();
            fillUpBuyOrderForm(data);
        });

        $(document).on('click', '.base_item_balance, .lowest_ask, .stock_item_balance, .highest_bid', function (event) {
            let selector = '#' + $(this).closest('.box').find('form').attr('id');
            let value = $(this).text();

            if ($(this).hasClass('base_item_balance')) {
                $(selector + ' .total').val(value);
                event.target.classList.add('total');
            } else if ($(this).hasClass('stock_item_balance')) {
                $(selector + ' .amount').val(value);
                event.target.classList.add('amount');
            } else {
                $(selector + ' .price').val(value);
                event.target.classList.add('price');
            }

            calculateOrderForm(event, value, selector);
        });

        $(document).on('keyup', '.price, .amount, .total', function (event) {
            let selector = '#' + $(this).closest('form').attr('id');
            calculateOrderForm(event, $(this).val(), selector);
        });

        $(document).on('click', '.delete_order', function (event) {
            event.preventDefault();
            let token = $('meta[name="csrf-token"]').attr('content');
            let $this = $(this);
            let url = $this.attr('href');
            $this.closest('td').html('<span class="text-red">Cancelling</span>');

            $.ajax({
                type: 'POST',
                url: url,
                data: {_token: token,_method : 'DELETE'},
                success: function () {

                }
            });
        });

        $(document).on('click', '#candlestick li a', function (event) {
            defaultInterval = $(this).data('interval') || 240;
            $('#candlestick li').removeClass('disabled');
            $(this).closest('li').addClass('disabled');
            initStockChart(defaultStockPairId, defaultInterval);
            updateChartZoom();
        });

        $(document).on('click', '#candlestick_zoom li a', function (event) {
            $('#candlestick_zoom li').removeClass('disabled');
            $(this).closest('li').addClass('disabled');
            defaultZoom = parseInt($(this).data('zoom'));
            updateChartZoom();
        });

        // Stock Market Toggling
        $('#fixed-stock-market-toggler').on('click', function () {
            var $this = $(this);
            if ($this.hasClass('opened')) {
                $this.removeClass('opened')
                $('#fixed-stock-market').removeClass('opened')
            } else {
                $this.addClass('opened')
                $('#fixed-stock-market').addClass('opened')
            }
        });

        $(document).on('click', function (e) {
            if ($(e.target).closest("#fixed-stock-market").length === 0) {
                $('#fixed-stock-market-toggler').removeClass('opened');
                $('#fixed-stock-market').removeClass('opened');
            }

        });
    });
</script>

    <script>

    function broadcast() {
        let channelPrefix = 'dexzbitz_';
        Echo.channel(channelPrefix + 'orders.' + defaultStockPairId).listen('Exchange.BroadcastOrder', (data) => {
            processOrderTable(data);
        }).listen('Exchange.BroadcastCancelOrder', (data) => {
            processOrderTable(data);
        });

        if (user) {
            Echo.private(channelPrefix + 'orders.' + defaultStockPairId + '.' + user.id).listen('Exchange.BroadcastPrivateOrder', (data) => {
                updateMyOpenOrderTable(data);
                updateOrderFormOnOrderPlace(data);
            }).listen('Exchange.BroadcastPrivateCancelOrder', (data) => {
                updateMyOpenOrderTable(data);
                updateOrderFormOnCancel(data);
            });
        }


        Echo.channel(channelPrefix + 'exchange.' + defaultStockPairId).listen('Exchange.BroadcastStockExchange', (data) => {

            $.each(data.exchangedOrders[exchangeTypeBuy], function (_, buy) {
                if (buy) {
                    updateOrdersBook(buyOrderTable, buy);
                    updateOrderBookTotal($('#total_buy_order_in_base'), buy.total);
                    if (buy.is_maker) {
                        buy.amount = bcmul(buy.amount, '-1');
                        buy.total = bcmul(buy.total, '-1');
                        updateTradeHistory(tradeHistoryTable, buy);
                    }
                }
            });

            $.each(data.exchangedOrders[exchangeTypeSell], function (_, sell) {
                if (sell) {
                    updateOrdersBook(sellOrderTable, sell);
                    updateOrderBookTotal($('#total_sell_order_in_item'), sell.amount);
                    if (sell.is_maker) {
                        sell.amount = bcmul(sell.amount, '-1');
                        sell.total = bcmul(sell.total, '-1');
                        updateTradeHistory(tradeHistoryTable, sell);
                    }
                }

            });

            updateChart(data.chartData);
            updateStockPairSummary(data.stockPairSummary)
        }).listen('Exchange.BroadcastSettlementOrders', (data) => {
            let table = sellOrderTable;
            let removeAmount = data.amount;

            if (data.exchange_type == exchangeTypeBuy) {
                table = buyOrderTable;
                removeAmount = data.total;
            }
            updateOrdersBook(table, data);
            updateOrderBookTotal($('#total_sell_order_in_item'), removeAmount);
        });

        Echo.channel(channelPrefix + 'exchange').listen('Exchange.BroadcastStockPairSummary', (data) => {
            updateStockMarketTable(data);
        });

        if (user) {
            Echo.private(channelPrefix + 'exchange.' + defaultStockPairId + '.' + user.id).listen('Exchange.BroadcastPrivateStockExchange', (data) => {
                $.each(data, function (_, order) {
                    if (order) {
                        updateMyOpenOrderTable(order);
                        updateMyTradeHisty(order);
                        updateOrderFormOnExchange(order);
                    }
                });
            }).listen('Exchange.BroadcastPrivateSettlementOrder', (data) => {
                $.each(data, function (_, order) {
                    if (order) {
                        updateMyOpenOrderTable(order);
                    }
                });
            });


        }
    }
</script>
    <script>
    function updateChartZoom() {
        let zoom = calculateZoom();

        eChart.setOption({
            dataZoom: [
                {
                    start: zoom
                },
                {
                    start: zoom
                }
            ]
        });
    }

    function updateStockMarketTable(data) {
        let row = stockMarketTable.row('#stock_market' + data.stock_pair_id);
        let rowData = row.data();

        if (rowData) {
            let status = 'updated';

            if (rowData.last_price > data.last_price) {
                status = 'deleted';
            } else if (rowData.last_price < data.last_price) {
                status = 'inserted'
            }

            rowData.last_price = data.last_price;
            rowData.exchanged_base_item_volume_24 = data.exchanged_base_item_volume_24;
            rowData.change_24 = number_format(data.change_24, 2);
            row.data(rowData).invalidate();
            rowHighlight(row.node(), status);
            stockMarketTable.draw();
        }
    }

    function processOrderTable(data) {
        let selector, table, total;

        if (data.exchange_type == exchangeTypeBuy) {
            table = buyOrderTable;
            selector = $('#total_buy_order_in_base');
            total = data.order.total;
        } else {
            table = sellOrderTable;
            selector = $('#total_sell_order_in_item');
            total = data.order.amount;
        }

        updateOrdersBook(table, data.order);
        updateOrderBookTotal(selector, total);
    }

    function updateMyOpenOrderTable(data) {
        let row = myOpenOrderTable.row("#" + data.order_number);
        let rowData = row.data();

        if (rowData) {
            rowData.amount = bcsub(rowData.amount, data.amount);
            if (rowData.amount > 0) {
                row.data(rowData).invalidate();
                rowHighlight(row.node(), 'updated');
            } else {
                myOpenOrderTable.rows(row).remove();
            }
        } else {
            let row = myOpenOrderTable.row.add(data).node();
            rowHighlight(row, 'inserted');
        }

        myOpenOrderTable.draw();
    }

    function calculateOrderForm(event, value, selector) {
        if (event.target.classList.contains('price')) {

            let amount = $(selector + ' .amount').val() || '0';
            let total = bcmul(amount, value);
            total = isNaN(total) ? 0 : total;
            $(selector + ' .total').val(total);

        } else if (event.target.classList.contains('amount')) {

            let price = $(selector + ' .price').val() || '0';
            let total = bcmul(price, value);
            total = isNaN(total) ? 0 : total;
            $(selector + ' .total').val(total);
        } else {
            let price = $(selector + ' .price').val() || '0';
            let amount = bcdiv(value, price);

            amount = isNaN(amount) ? 0 : amount;

            $(selector + ' .amount').val(amount);
        }
    }

    function initOrderForm() {

        $('.stock-pair').val(defaultStockPairId);

        $.ajax({
            type: 'GET',
            url: 'https://dexzbitz.live/exchange/get-wallet-summary',
            data: {stock_pair_id: defaultStockPairId},
            success: function (data) {
                $('.base_item_balance').text(number_format(data.base_item_balance));
                $('.stock_item_balance').text(number_format(data.stock_item_balance));

                $('#buy_order_form .amount').val('');
                $('#buy_order_form .total').val('');

                $('#sell_order_form .amount').val('');
                $('#sell_order_form .total').val('');
            }
        });
    }

    function fillUpSellOrderForm(data) {
        $('#sell_order_form .price').val(data.price);
        $('#sell_order_form .amount').val(data.total_stock_item);
        $('#sell_order_form .total').val(data.total_base_item);

        $('#buy_order_form .price').val(data.price);
        $('#buy_order_form .amount').val('');
        $('#buy_order_form .total').val('');
    }

    function fillUpBuyOrderForm(data) {
        $('#buy_order_form .price').val(data.price);
        $('#buy_order_form .amount').val(data.total_stock_item);
        $('#buy_order_form .total').val(data.total_base_item);

        $('#sell_order_form .price').val(data.price);
        $('#sell_order_form .amount').val('');
        $('#sell_order_form .total').val('');


    }


    function updateChart(data) {
        let lastChartData = chartData.slice(-1)[0];
        let intervalDate = data.interval[defaultInterval];

        if (lastChartData[0] == intervalDate) {
            lastChartData[2] = data.price;

            if (lastChartData[1] == 0) {
                lastChartData[1] = data.price;
            }

            if (lastChartData[3] > data.price || lastChartData[3] == 0) {
                lastChartData[3] = data.price;
            }

            if (lastChartData[4] < data.price) {
                lastChartData[4] = data.price;
            }
        } else {
            chartData.push([
                data.date,
                data.price,
                data.price,
                data.price,
                data.price,
            ])
        }

        makeChart(document.getElementById('echart'), chartData)

    }


    function updateTradeHistory(table, data) {
        let row = table.row.add(data).node();
        rowHighlight(row, 'inserted');
        table.draw();
    }

    function updateMyTradeHisty(data) {
        myTradeHistoryTable.row.add(data);
        myTradeHistoryTable.draw();
    }

    function updateOrdersBook(table, data) {
        let row = table.row("#" + hash(data.price));
        let rowData = row.data();

        if (rowData) {
            rowData.amount = bcadd(rowData.amount, data.amount);
            rowData.total = bcadd(rowData.total, data.total);
            if (rowData.amount > 0) {
                row.data(rowData).invalidate();
                rowHighlight(row.node(), 'updated');
            } else {
                table.rows(row).remove();
            }

            table.draw();

        } else {
            row = table.row.add(data).draw().node();
            rowHighlight(row, 'inserted');
        }
    }

    function updateOrderBookTotal(selector, total) {
        let grandTotal = bcadd(selector.text(), total);
        selector.text(grandTotal);
    }


    function updateStockPairSummary(data) {
        $('#last_price').text(number_format(data.last_price));
        let change = '';
        if (parseFloat(data.change_24) > 0) {
            change = '<i class="fa fa-caret-up text-green"></i> ';
        } else if (parseFloat(data.change_24) < 0) {
            change = '<i class="fa fa-caret-down text-red"></i> ';
        } else {
            change = '<i class="fa fa-sort text-gray"></i> ';
        }

        $('#_24_hour_percentage').html(change + ' ' + number_format(Math.abs(data.change_24), 2) + '%');
        $('#_24_hour_high').text(number_format(data.high_24));
        $('#_24_hour_low').text(number_format(data.low_24));

        $('#_24_hour_base_volume').text(number_format(data.exchanged_base_item_volume_24, 3));
        $('#_24_hour_item_volume').text(number_format(data.exchanged_stock_item_volume_24, 3));

        if (data.base_item_abbr) {
            $('.base_item').text(data.base_item_abbr);
        }

        if (data.stock_item_abbr) {
            $('.stock_item').text(data.stock_item_abbr);
        }

    }

    function number_format(number, decimalPoint = 8) {
        number = parseFloat(number);
        return number.toFixed(decimalPoint);
    }

    function initStockChart(stockPairId, interval) {
        $.ajax({
            type: 'GET',
            url: 'https://dexzbitz.live/exchange/get-chart-data',
            data: {stock_pair_id: stockPairId, interval: interval},
            success: function (data) {
                chartData = data;
                makeChart(document.getElementById('echart'), chartData);
                $(window).resize(function () {
                    eChart.resize();
                })
            }
        });
    }

    function hash(number) {
        number = number_format(number);
        let res = number.replace(/[0-9]|\./gi, function myFunction(x) {
            if (x == 0) {
                return 'z';
            } else if (x == 1) {
                return 'o';
            } else if (x == 2) {
                return 't';
            } else if (x == 3) {
                return 'r';
            } else if (x == 4) {
                return 'f';
            } else if (x == 5) {
                return 'i';
            } else if (x == 6) {
                return 's';
            } else if (x == 7) {
                return 'e';
            } else if (x == 8) {
                return 'g';
            } else if (x == 9) {
                return 'n';
            } else {
                return 'x';
            }


        });

        return res;
    }

    function initBuyStockOrderTable() {
        buyOrderTable = $('#buy_order_table').DataTable({
            destroy: true,
            order: [[0, 'desc']],
            paging: false,
            searching: false,
            info: false,
            scrollY: 385,
            ajax: {
                url: 'https://dexzbitz.live/exchange/get-orders',
                data: {
                    stock_pair_id: defaultStockPairId,
                    last_price: null,
                    exchange_type: exchangeTypeBuy,
                    exchange_category: exchangeCategory
                },
                dataSrc: function (data) {
                    let baseItemTotal = data.totalStockOrder.base_total || 0;
                    $('#total_buy_order_in_base').text(number_format(baseItemTotal));
                    return data.stockOrders;
                }
            },
            language: {
                sLoadingRecords: '<span style="width:100%;"><img src="https://dexzbitz.live/common/images/loader.svg"></span>'
            },
            drawCallback: function () {
                let api = this.api();

                let totalBaseItem = '0';
                let totalStockItem = '0';
                let heightBid = 0;
                let rowCount = 0;
                api.rows().every(function (rowId) {
                    let data = this.data();

                    if (rowId == 0) {
                        heightBid = data.price;

                    }

                    totalStockItem = bcadd(totalStockItem, data.amount);
                    totalBaseItem = bcmul(totalStockItem, data.price);

                    data.total_stock_item = number_format(totalStockItem);
                    data.total_base_item = number_format(totalBaseItem);

                    this.data(data);

                    rowCount++
                });

                $('.highest_bid').text(number_format(heightBid));
                $('#sell_order_form .price').val(number_format(heightBid));

                //Load more option
                if (rowCount > orderBookRowPerPage) {
                    if ($('#buy_order_load_more').length == 0 && buyOrderTableLoadMore) {
                        let tbody = '<tbody id="buy_order_load_more">' +
                            '<tr style="background-color: #a3ddd7">' +
                            '<td colspan="4"><a onClick="loadMoreData(' + exchangeTypeBuy + ')" style="color:#08534c;float:right" href="javascript:;">Load 50 more</a></td>' +
                            '</tr>' +
                            '</tbody>';
                        $('#buy_order_table').append(tbody);
                    } else {
                        $('#buy_order_load_more').remove();
                    }
                } else {
                    if ($('#buy_order_load_more').length == 1) {
                        $('#buy_order_load_more').remove();
                    }
                }
            },
            createdRow: function (row, data) {
                $(row).attr('id', hash(data.price));
            },
            columns: [
                {
                    data: 'price',
                    orderable: false,

                },
                {
                    data: "amount",
                    orderable: false,
                },
                {
                    data: 'total',
                    orderable: false,
                },
                {
                    data: 'total_base_item',
                    orderable: false,
                    className: 'hide_in_mobile_small',
                    render: function (data) {
                        return number_format(data);
                    }
                }
            ]
        });

    }

    function initSellStockOrderTable() {
        sellOrderTable = $('#sell_order_table').DataTable({
            destroy: true,
            paging: false,
            order: [[0, 'asc']],
            searching: false,
            info: false,
            scrollY: 385,
            ajax: {
                url: 'https://dexzbitz.live/exchange/get-orders',
                data: {
                    stock_pair_id: defaultStockPairId,
                    last_price: null,
                    exchange_type: exchangeTypeSell,
                    exchange_category: exchangeCategory
                },
                dataSrc: function (data) {
                    let stockItemTotal = data.totalStockOrder.item_total || 0;
                    $('#total_sell_order_in_item').text(number_format(stockItemTotal));
                    return data.stockOrders;
                }
            },
            language: {
                sLoadingRecords: '<span style="width:100%;"><img src="https://dexzbitz.live/common/images/loader.svg"></span>'
            },
            drawCallback: function () {
                let api = this.api();

                let totalStockItem = '0';
                let totalBaseItem = '0';
                let lowestAsk = 0;
                let rowCount = 0;
                api.rows().every(function (rowId) {
                    let data = this.data();

                    if (rowId == 0) {
                        lowestAsk = data.price;
                    }

                    totalStockItem = bcadd(totalStockItem, data.amount);
                    totalBaseItem = bcmul(totalStockItem, data.price);

                    data.total_stock_item = number_format(totalStockItem);
                    data.total_base_item = number_format(totalBaseItem);
                    this.data(data);
                    rowCount++;
                    sellOrderLastPrice = data.price;
                });

                $('.lowest_ask').text(number_format(lowestAsk));
                $('#buy_order_form .price').val(number_format(lowestAsk));

                //Load more option
                if (rowCount > orderBookRowPerPage) {
                    if ($('#sell_order_load_more').length == 0 && sellOrderTableLoadMore) {
                        let tbody = '<tbody id="sell_order_load_more">' +
                            '<tr style="background-color: #a3ddd7">' +
                            '<td colspan="4"><a onClick="loadMoreData(' + exchangeTypeSell + ')" style="color:#08534c;float:right" href="javascript:;">Load 50 more</a></td>' +
                            '</tr>' +
                            '</tbody>';
                        $('#sell_order_table').append(tbody);
                    } else {
                        $('#sell_order_load_more').remove();
                    }
                } else {
                    if ($('#sell_order_load_more').length == 1) {
                        $('#sell_order_load_more').remove();
                    }
                }


            },
            createdRow: function (row, data) {
                $(row).attr('id', hash(data.price));
            },
            columns: [
                {
                    data: 'price',
                    orderable: false,

                },
                {
                    data: "amount",
                    orderable: false,
                },
                {
                    data: "total",
                    orderable: false,
                },
                {
                    data: 'total_base_item',
                    orderable: false,
                    className: 'hide_in_mobile_small',
                    render: function (data) {
                        return number_format(data);
                    }
                }
            ]
        });

    }

    function initMyOpenOrderTable() {
        myOpenOrderTable = $('#my_open_order_table').DataTable({
            destroy: true,
            paging: false,
            searching: false,
            scrollY: 300,
            scrollCollapse: true,
            order: [[4, 'desc']],
            info: false,
            ajax: {
                url: 'https://dexzbitz.live/exchange/get-my-open-order',
                data: {
                    stock_pair_id: defaultStockPairId
                },
                dataSrc: function (data) {
                    return data;
                }
            },
            language: {
                sLoadingRecords: '<span style="width:100%;"><img src="https://dexzbitz.live/common/images/loader.svg"></span>'
            },
            createdRow: function (row, data) {
                $(row).attr('id', data.order_number);
            },
            columns: [
                {
                    data: null,
                    render: function (data) {
                        let html = '<span class="text-red">' + exchangeType[data.exchange_type] + '</span>';
                        if (data.exchange_type == exchangeTypeBuy) {
                            html = '<span class="text-green">' + exchangeType[data.exchange_type] + '</span>'
                        }

                        return html;
                    }
                },
                {
                    data: "price",
                },
                {
                    data: "amount"
                },
                {
                    data: null,
                    className: 'hide_in_mobile_small',
                    render: function (data) {
                        return bcmul(data.amount, data.price);
                    }
                },
                {
                    data: "date",
                    className: 'hide_in_mobile'
                },
                {
                    data: null,
                    className: 'hide_in_mobile',
                    render: function (data) {
                        return data.stop_limit ? data.stop_limit : '-';
                    }
                },
                {
                    data: null,
                    render: function (data) {
                        let url = orderCancelURL.replace('##', data.order_number);
                        return '<a class="delete_order" href="' + url + '">Cancel</a>';

                    }
                }
            ]
        });

    }

    function initMyTradeHistoryTable() {
        myTradeHistoryTable = $('#my_trade_table').DataTable({
            destroy: true,
            paging: false,
            searching: false,
            order: [[0, 'desc']],
            info: false,
            scrollY: 300,
            scrollCollapse: true,
            ajax: {
                url: 'https://dexzbitz.live/exchange/get-my-trade',
                data: {
                    stock_pair_id: defaultStockPairId
                },
                dataSrc: function (data) {
                    return data;
                }
            },
            language: {
                sLoadingRecords: '<span style="width:100%;"><img src="https://dexzbitz.live/common/images/loader.svg"></span>'
            },
            columns: [
                {
                    data: "date",
                    orderable: false,
                    className: 'hide_in_mobile'
                },
                {
                    data: null,
                    orderable: false,
                    render: function (data) {
                        let html = '<span class="text-red">' + exchangeType[data.exchange_type] + '</span>';
                        if (data.exchange_type == exchangeTypeBuy) {
                            html = '<span class="text-green">' + exchangeType[data.exchange_type] + '</span>'
                        }

                        return html;
                    }
                },
                {
                    data: "price",
                    orderable: false,
                    className: 'dt-body-center'
                },
                {
                    data: "amount",
                    orderable: false,
                    className: 'dt-body-center'
                },
                {
                    data: null,
                    orderable: false,
                    className: 'dt-body-center hide_in_mobile_small',
                    render: function (data) {
                        return bcmul(data.amount, data.price);
                    }
                }
            ]
        });

    }

    function initTradeHistoryTable() {
        tradeHistoryTable = $('#trade_history_table').DataTable({
            destroy: true,
            paging: false,
            searching: false,
            order: [[0, 'desc']],
            info: false,
            scrollY: 300,
            scrollCollapse: true,
            ajax: {
                url: 'https://dexzbitz.live/exchange/get-trade-histories',
                data: {
                    stock_pair_id: defaultStockPairId
                },
                dataSrc: function (data) {
                    return data;
                }
            },
            language: {
                sLoadingRecords: '<span style="width:100%;"><img src="https://dexzbitz.live/common/images/loader.svg"></span>'
            },
            columns: [
                {
                    data: "date",
                    orderable: false,
                    className: 'hide_in_mobile'
                },
                {
                    data: null,
                    orderable: false,
                    render: function (data) {
                        let html = '<span class="text-red">' + exchangeType[data.exchange_type] + '</span>';
                        if (data.exchange_type == exchangeTypeBuy) {
                            html = '<span class="text-green">' + exchangeType[data.exchange_type] + '</span>'
                        }

                        return html;
                    }
                },
                {
                    data: "price",
                    orderable: false,
                    className: 'dt-body-center'
                },
                {
                    data: "amount",
                    orderable: false,
                    className: 'dt-body-center'
                },
                {
                    data: null,
                    orderable: false,
                    className: 'dt-body-center hide_in_mobile_small',
                    render: function (data) {
                        return bcmul(data.amount, data.price);
                    }
                }
            ]
        });

        initScroller();
    }

    function rowHighlight(row, className, animationTime = 1000) {
        $(row).addClass(className);
        setTimeout(autoTransition, animationTime);

        function autoTransition() {
            $(row).removeClass(className);
        }
    }

    function initScroller() {
        $(".dataTables_scrollBody").mCustomScrollbar("destroy");
        $(".dataTables_scrollBody").mCustomScrollbar({
            axis: "y",
            theme: "dark-thick",
        });
    }

    function loadMoreData(exchangeType) {

        let lastPrice = sellOrderLastPrice;
        let table = sellOrderTable;
        let loadMore = sellOrderTableLoadMore;
        if (exchangeType == exchangeTypeBuy) {
            lastPrice = buyOrderLastPrice;
            table = buyOrderTable;
            loadMore = buyOrderTableLoadMore;
        }

        $.ajax({
            type: 'GET',
            url: 'https://dexzbitz.live/exchange/get-orders',
            data: {
                stock_pair_id: defaultStockPairId,
                exchange_type: exchangeType,
                exchange_category: exchangeCategory,
                last_price: lastPrice
            },
            success: function (data) {
                let length = data.stockOrders.length;
                if (length) {

                    if (length < orderBookRowPerPage) {
                        loadMore = false;
                    }

                    table.rows.add(data.stockOrders);
                    table.draw();

                }
            }
        });
    }

    function updateOrderFormOnCancel(data) {
        if (data.exchange_type == exchangeTypeBuy) {
            let baseItemBalance = $('.base_item_balance').first().text();
            baseItemBalance = bcadd(baseItemBalance, data.total);
            $('.base_item_balance').text(baseItemBalance);
        } else {
            let stockItemBalance = $('.stock_item_balance').first().text();
            stockItemBalance = bcadd(stockItemBalance, data.amount);
            $('.stock_item_balance').text(stockItemBalance);
        }
    }

    function updateOrderFormOnOrderPlace(data) {
        if (data.exchange_type == exchangeTypeBuy) {
            let baseItemBalance = $('.base_item_balance').first().text();
            baseItemBalance = bcsub(baseItemBalance, data.total);
            $('.base_item_balance').text(baseItemBalance);
        } else {
            let stockItemBalance = $('.stock_item_balance').first().text();
            stockItemBalance = bcsub(stockItemBalance, data.amount);
            $('.stock_item_balance').text(stockItemBalance);
        }
    }

    function updateOrderFormOnExchange(data) {
        if (data.exchange_type == exchangeTypeBuy) {
            let stockItemBalance = $('.stock_item_balance').first().text();
            stockItemBalance = bcadd(stockItemBalance, bcsub(data.amount, data.fee));
            $('.stock_item_balance').text(stockItemBalance);
        } else {
            let baseItemBalance = $('.base_item_balance').first().text();
            baseItemBalance = bcadd(baseItemBalance, bcsub(data.total, data.fee));
            $('.base_item_balance').text(baseItemBalance);
        }
    }

    function changeUrl(data) {
        let url = "https://dexzbitz.live/exchange/" + (data.stock_item_abbr + "-" + data.base_item_abbr).toLowerCase();
        window.history.pushState({}, null, url);
    }

</script>	
	

</body>
</html>